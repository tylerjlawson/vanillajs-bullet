<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <span>test foo</span>
      <span>John Doe is here</span>
      <span>This is fun</span>
      <span>Hallellujah I like apples</span>
      <span>Where's my nachos?</span>
    </div>
  </body>
  <script>
    const BULLET_WIDTH = 40;
    const container = document.querySelector(".container");
    let lastWidth = 0;

    const rerenderDots = () => {
      const spans = [...document.querySelectorAll("span")];
      const spanLengths = spans.map((span) => span.offsetWidth);
      let countWidth = 0;
      const lines = spans.reduce((acc, span, ind) => {
        const len = spanLengths[ind];
        countWidth += len + BULLET_WIDTH;
        if (countWidth <= container.clientWidth) {
          acc[acc.length - 1].push(span);
        } else {
          countWidth = len + BULLET_WIDTH;
          acc.push([span]);
        }
        return acc
      }, [[]]);
      lines.forEach((line) => {
        line.forEach((span, ind) => {
          if (ind === line.length - 1) {
            span.classList.remove("has-delim");
          } else {
            line[ind].classList.add("has-delim");
          }
        });
      });
      const newHtml = lines.reduce((acc, line) => {
        const lineHtmlStrings = line.map((ele) => ele.outerHTML);
        const lineHtml =
          '<div class="row">' + lineHtmlStrings.join("") + "</div>";
        acc += lineHtml;
        return acc;
      }, "");
      container.innerHTML = newHtml;
    }

    const renderDots = ()  => {
      const rows = [...document.querySelectorAll('.row')];

      if (rows.length) {
        // strategy is to rerender only when necessary
        const growing = container.offsetWidth > lastWidth;
        if (growing) {
          rerenderDots();
        } else {
          const rowNotFit = rows.some(row => row.offsetWidth > container.offsetWidth - BULLET_WIDTH);
          if (rowNotFit) rerenderDots();
        }
      } else {
        // no rows yet, so render
        rerenderDots();
      }

      lastWidth = container.offsetWidth;
    }

    let timeout = false, // holder for timeout id
    delay = 250;
    window.addEventListener("load", renderDots);
    window.addEventListener('resize', function() {
      // clear the timeout
      clearTimeout(timeout);
      // start timing for event "completion"
      timeout = setTimeout(renderDots, delay);
    });
  </script>
</html>
